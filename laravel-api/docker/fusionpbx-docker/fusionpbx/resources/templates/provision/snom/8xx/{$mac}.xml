<?xml version="1.0" encoding="utf-8"?>
{* V11 2019-05-10 *}
{* Variables used *}
{* snom_time_zone - Timezone in SNOM format http://wiki.snom.com/Settings/timezone *}
{* snom_language - Language to use with phone http://wiki.snom.com/Settings/language *}
{* snom_firmware_path - Firmware path https://service.snom.com/display/wiki/Deskphones+Firmware *}
{* snom_gui_fkeyX - GUI softkeys config http://wiki.snom.com/Settings/gui_fkey *}
{* snom_dim_timer - Dim timer http://wiki.snom.com/Settings/dim_timer *}
{* snom_tonescheme - Tone sheme to use http://wiki.snom.com/Settings/thttp://wiki.snom.com/Settings/attended_transfer_on_ringingone_scheme *}
{* snom_time_format - US/EU time format http://wiki.snom.com/Settings/date_us_format *}
{* snom_call_waiting - Call waiting (on/off/visual/ringer) - http://wiki.snom.com/Settings/call_waiting *}
{* snom_green_blf - Use green/off BLF for indicate idle state. on/off http://wiki.snom.com/Settings/led_green http://wiki.snom.com/Settings/led_on *}
{* snom_update_policy - Update policy http://wiki.snom.com/Settings/update_policy *}
{* snom_dhcp - DHCP options http://wiki.snom.com/Settings/dhcp *}
{* snom_attended_transfer_on_ringing - http://wiki.snom.com/Settings/attended_transfer_on_ringing *}
{* snom_status_msgs_that_show_directly - http://wiki.snom.com/Settings/status_msgs_that_show_directly *}
{* snom_monitor_calls - Monitor ongoing calls on the screen http://wiki.snom.com/Settings/goto_monitor_state_on_line_activity *}
{* snom_resync_peiod - Resync configuration period http://wiki.snom.com/Settings/settings_refresh_timer *}
{* snom_backgrouond_image_url - URL of background image http://wiki.snom.com/Settings/custom_bg_image_url *}
{* snom_enable_srtp - Enable or disable SRTP by default http://wiki.snom.com/Settings/user_srtp *}
{* snom_dtmf_mode -Set DTMF mode http://wiki.snom.com/Settings/user_dtmf_info *}
{* snom_vpn_enable - Snom VPN *}
{* snom_syslog_server - Syslog server *}
{* snom_is_D3xx - for compatibility *}

{$regularKeys = 16}
{$snom_is_D3xx = false}

<settings>
<phone-settings e="2">
<timezone perm="!">{$snom_time_zone}</timezone>
<ntp_server perm="R">{$ntp_server_primary}</ntp_server>
<language perm="!">{$snom_language}</language>
{if isset($snom_vpn_enable)}
<vpn_on perm="R">{$snom_vpn_enable}</vpn_on>
<vpn_tarball_url perm="R">https://{$http_auth_username}:{$http_auth_password}@{$domain_name}{$project_path}/app/provision/{$mac}-snomovpn.tar</vpn_tarball_url>
{/if}
{if isset($snom_syslog_server)}
<syslog_server perm="R">{$snom_syslog_server}</syslog_server>
{/if}

<gui_fkey1 perm="R">{if isset ($snom_gui_fkey1)}{$snom_gui_fkey1}{else}F_REGS{/if}</gui_fkey1>
<gui_fkey2 perm="R">{if isset ($snom_gui_fkey2)}{$snom_gui_fkey2}{else}F_CALL_LIST{/if}</gui_fkey2>
<gui_fkey3 perm="R">{if isset ($snom_gui_fkey3)}{$snom_gui_fkey3}{else}F_REDIRECT{/if}</gui_fkey3>
<gui_fkey4 perm="R">{if isset ($snom_gui_fkey4)}{$snom_gui_fkey4}{else}F_SUPPORT{/if}</gui_fkey4>

<dim_timer perm="R">{if isset ($snom_dim_timer)}{$snom_dim_timer}{else}20{/if}</dim_timer>

<tone_scheme perm="R">{$snom_tonescheme}</tone_scheme>
<date_us_format perm="R">{if isset($snom_time_format)}{$snom_time_format}{else}off{/if}</date_us_format>
<dialnumber_us_format perm="R">{if isset($snom_time_format)}{$snom_time_format}{else}off{/if}</dialnumber_us_format>

<call_waiting perm="R">{if isset ($snom_call_waiting)}{$snom_call_waiting}{else}on{/if}</call_waiting>
<admin_mode_password perm="R">{$admin_password}</admin_mode_password>
<admin_mode_password_confirm perm="R">{$admin_password}</admin_mode_password_confirm>
<http_user perm="R">{$admin_name}</http_user>
<http_pass perm="R">{$admin_password}</http_pass>
<http_client_user perm="R">{$http_auth_username}</http_client_user>
<http_client_pass perm="R">{$http_auth_password}</http_client_pass>

{if isset ($snom_green_blf)}
{if $snom_green_blf == "on"}
<led_on perm="R">idle ON BUSY IN_A_CALL CALLING IN_A_MEETING URGENT_INTERRUPTIONS_ONLY DND UNAVAILABLE ACTIVE INACTIVE BE_RIGHT_BACK AWAY SEIZED CONNECTED ON_HOLD OFFHOOK RINGBACK I-Am-Ready AVAILABLE I-Am-Busy PhoneHasCall PhoneHasMissedCalls</led_on>
<led_green perm="R">idle AVAILABLE  I-Am-Ready I-Am-Almost-Ready</led_green>
{/if}
{else}
<led_on perm="R">ON IN_A_CALL CALLING IN_A_MEETING URGENT_INTERRUPTIONS_ONLY BUSY I-Am-Busy DND_ALL DND_SELF ACTIVE INACTIVE BE_RIGHT_BACK SEIZED CONNECTED ON_HOLD OFFHOOK RINGBACK I-Am-Ready AWAY AVAILABLE AVAILABLE_ON_MOBILE AVAILABLE_AT_DESK PhoneHasCall PhoneHasMissedCalls CurrentIdentityHasVoiceMessages PhoneHasVoiceMessages seized_local seized_remote active_local active_remote</led_on>
<led_green perm="R">AVAILABLE AVAILABLE_ON_MOBILE AVAILABLE_AT_DESK I-Am-Ready I-Am-Almost-Ready seized_local alerting_local active_local held_local</led_green>
{/if}

<update_policy perm="R">{if isset($snom_update_policy)}{$snom_update_policy}{else}settings_only{/if}</update_policy>
<setting_server perm="R">https://{$domain_name}{$project_path}/app/provision/index.php?mac={$mac}</setting_server>
<dhcp perm="R">{if isset($snom_dhcp)}{$snom_dhcp}{else}on{/if}</dhcp>

<firmware perm="R">{$snom_firmware_path}</firmware>

<attended_transfer_on_ringing perm="R">{if isset ($snom_attended_transfer_on_ringing)}{$snom_attended_transfer_on_ringing}{else}on{/if}</attended_transfer_on_ringing> 
{if isset($snom_status_msgs_that_show_directly)}<status_msgs_that_show_directly perm="R">{$snom_status_msgs_that_show_directly}</status_msgs_that_show_directly>{/if}
{if isset ($snom_monitor_calls)}<goto_monitor_state_on_line_activity perm="R">{$snom_monitor_calls}</goto_monitor_state_on_line_activity>{/if}
<settings_refresh_timer perm="R">{if isset ($snom_resync_peiod)}{$snom_resync_peiod}{else}7200{/if}</settings_refresh_timer>

{if isset ($snom_backgrouond_image_url)}<custom_bg_image_url perm="R">{$snom_backgrouond_image_url}</custom_bg_image_url>{/if}

{foreach $lines as $row}
<!-- line {$row.line_number}: -->
<user_active idx="{$row.line_number}" perm="R">on</user_active>
<user_realname idx="{$row.line_number}" perm="R">{$row.display_name}</user_realname>
<user_name idx="{$row.line_number}" perm="R">{$row.user_id}</user_name>
<user_pass idx="{$row.line_number}" perm="R">{$row.password}</user_pass>
<user_host idx="{$row.line_number}" perm="R">{$row.server_address}</user_host>
<user_outbound idx="{$row.line_number}" perm="R">{if $row.outbound_proxy_primary neq ""}{$row.outbound_proxy_primary}{else}{$row.server_address}{/if}{if $row.sip_transport neq "dns srv"};transport={$row.sip_transport}{/if}</user_outbound>
{if $row.auth_id neq ''}<user_pname idx="{$row.line_number}" perm="R">{$row.auth_id}</user_pname>{/if}
<user_server_type idx="{$row.line_number}" perm="R">Default</user_server_type>
<user_srtp idx="{$row.line_number}" perm="R">{if isset ($snom_enable_srtp)}{$snom_enable_srtp}{else}off{/if}</user_srtp>
<user_mailbox idx="{$row.line_number}" perm="R">*97</user_mailbox>
<user_dtmf_info idx="{$row.line_number}" perm="R">{if isset ($snom_dtmf_mode)}{$snom_dtmf_mode}{else}off{/if}</user_dtmf_info>
<user_symmetrical_rtp idx="{$row.line_number}" perm="R">on</user_symmetrical_rtp>
<user_ice idx="{$row.line_number}" perm="R">off</user_ice>
<stun_server idx="{$row.line_number}" perm="R"></stun_server>
<codec_priority_list idx="{$row.line_number}" perm="R">g722,pcmu,pcma,g729{if $snom_dtmf_mode neq "sip_info_only"},telephone-event{/if}</codec_priority_list>
<user_expiry idx="{$row.line_number}" perm="R">{$row.register_expires}</user_expiry>
<user_subscription_expiry idx="{$row.line_number}" perm="R">{$row.register_expires}</user_subscription_expiry>
<retry_after_failed_subscribe idx="{$row.line_number}" perm="R">5</retry_after_failed_subscribe>
{/foreach}
</phone-settings>

<functionKeys>
{foreach $keys["expansion"] as $row}
	{if $row.device_key_line == "" || $row.device_key_line == "0"}
		{if $row.device_key_type == "line"}
			<fkey idx="{$row.device_key_id-1+$regularKeys+$snom_is_D3xx*126}" context="active" label="{$row.device_key_label}" perm="R">line</fkey>
		{else if $row.device_key_type == "blf"}
			<fkey idx="{$row.device_key_id-1+$regularKeys+$snom_is_D3xx*126}" context="active" label="{$row.device_key_label}" perm="R">blf &lt;sip:{$row.device_key_value}@{$domain_name};user=phone&gt;|**</fkey>
		{else if $row.device_key_type == "keyevent"}
				<fkey idx="{$row.device_key_id-1+$regularKeys+$snom_is_D3xx*126}" context="active" label="{$row.device_key_label}" lp="on" perm="R">keyevent {$row.device_key_value}</fkey>
		{else}
			<fkey idx="{$row.device_key_id-1+$regularKeys+$snom_is_D3xx*126}" context="active" label="{$row.device_key_label}" perm="R">{$row.device_key_type} {$row.device_key_value} {$row.device_key_extension}</fkey>
		{/if}
	{else}
		{if $row.device_key_type == "line"}
			<fkey idx="{$row.device_key_id-1+$regularKeys+$snom_is_D3xx*126}" context="active" label="{$row.device_key_label}" perm="R">line</fkey>
		{else if $row.device_key_type == "blf"}
			<fkey idx="{$row.device_key_id-1+$regularKeys+$snom_is_D3xx*126}" context="{$row.device_key_line}" label="{$row.device_key_label}" perm="R">blf &lt;sip:{$row.device_key_value}@{$domain_name};user=phone&gt;|**</fkey>
		{else if $row.device_key_type == "keyevent"}
				<fkey idx="{$row.device_key_id-1+$regularKeys+$snom_is_D3xx*126}" context="active" label="{$row.device_key_label}" lp="on" perm="R">keyevent {$row.device_key_value}</fkey>
		{else}
			<fkey idx="{$row.device_key_id-1+$regularKeys+$snom_is_D3xx*126}" context="{$row.device_key_line}" label="{$row.device_key_label}" perm="R">{$row.device_key_type} {$row.device_key_value} {$row.device_key_extension}</fkey>
		{/if}
	{/if}
{/foreach}
{foreach $keys["line"] as $row}
	{if $row.device_key_id <= $regularKeys}
		{if $row.device_key_line == "" || $row.device_key_line == "0"}
			{if $row.device_key_type == "line"}
				<fkey idx="{$row.device_key_id-1}" context="active" label="{$row.device_key_label}" perm="R">line</fkey>
			{else if $row.device_key_type == "blf"}
				<fkey idx="{$row.device_key_id-1}" context="active" label="{$row.device_key_label}" perm="R">blf &lt;sip:{$row.device_key_value}@{$domain_name};user=phone&gt;|**</fkey>
			{else if $row.device_key_type == "keyevent"}
				<fkey idx="{$row.device_key_id-1}" context="active" label="{$row.device_key_label}" lp="on" perm="R">keyevent {$row.device_key_value}</fkey>
			{else}
				<fkey idx="{$row.device_key_id-1}" context="active" label="{$row.device_key_label}" perm="R">{$row.device_key_type} {$row.device_key_value} {$row.device_key_extension}</fkey>
			{/if}
		{else}
			{if $row.device_key_type == "line"}
				<fkey idx="{$row.device_key_id-1}" context="active" label="{$row.device_key_label}" perm="R">line</fkey>
			{else if $row.device_key_type == "blf"}
				<fkey idx="{$row.device_key_id-1}" context="{$row.device_key_line}" label="{$row.device_key_label}" perm="R">blf &lt;sip:{$row.device_key_value}@{$domain_name};user=phone&gt;|**</fkey>
			{else if $row.device_key_type == "keyevent"}
				<fkey idx="{$row.device_key_id-1}" context="active" label="{$row.device_key_label}" lp="on" perm="R">keyevent {$row.device_key_value}</fkey>
			{else}
				<fkey idx="{$row.device_key_id-1}" context="{$row.device_key_line}" label="{$row.device_key_label}" perm="R">{$row.device_key_type} {$row.device_key_value} {$row.device_key_extension}</fkey>
			{/if}
		{/if}
	{else}
		<!-- {$row.device_key_id} außerhalb des Bereichs -->
	{/if}
{/foreach}
</functionKeys>

{if isset($snom_phonebook_url)}
	{fetch file=''|cat:$snom_phonebook_url|cat:'&vendor=snom'}
{/if}

</settings>